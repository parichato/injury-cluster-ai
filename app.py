import streamlit as st
import pandas as pd
import joblib

scaler = joblib.load("scaler.pkl")
kmeans = joblib.load("injury_cluster.pkl")

st.title("üöë ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ú‡∏π‡πâ‡∏ö‡∏≤‡∏î‡πÄ‡∏à‡πá‡∏ö")
st.write("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ú‡∏π‡πâ‡∏ö‡∏≤‡∏î‡πÄ‡∏à‡πá‡∏ö‡πÉ‡∏´‡πâ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥")

age = st.number_input("‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)", 0, 120, 25)
sex = st.selectbox("‡πÄ‡∏û‡∏®", ["‡∏ä‡∏≤‡∏¢", "‡∏´‡∏ç‡∏¥‡∏á"])
is_night = st.selectbox("‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏", ["‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô", "‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô"])
head_injury = st.selectbox("‡∏ö‡∏≤‡∏î‡πÄ‡∏à‡πá‡∏ö‡∏®‡∏µ‡∏£‡∏©‡∏∞‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà", ["‡πÑ‡∏°‡πà", "‡πÉ‡∏ä‡πà"])
risk1 = st.selectbox("‡∏Ç‡∏±‡∏ö‡∏Ç‡∏µ‡πà‡πÄ‡∏£‡πá‡∏ß/‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á", ["‡πÑ‡∏°‡πà", "‡πÉ‡∏ä‡πà"])
cannabis = st.selectbox("‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ç‡∏ä‡∏≤", ["‡πÑ‡∏°‡πà", "‡πÉ‡∏ä‡πà"])
amphetamine = st.selectbox("‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏ö‡πâ‡∏≤", ["‡πÑ‡∏°‡πà", "‡πÉ‡∏ä‡πà"])
drugs = st.selectbox("‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏≠‡∏∑‡πà‡∏ô ‡πÜ", ["‡πÑ‡∏°‡πà", "‡πÉ‡∏ä‡πà"])

X_new = pd.DataFrame([{
    "age": age,
    "sex": 1 if sex == "‡∏ä‡∏≤‡∏¢" else 0,
    "is_night": 1 if is_night == "‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô" else 0,
    "head_injury": 1 if head_injury == "‡πÉ‡∏ä‡πà" else 0,
    "risk1": 1 if risk1 == "‡πÉ‡∏ä‡πà" else 0,
    "risk2": 0, "risk3": 0, "risk4": 0, "risk5": 0,
    "cannabis": 1 if cannabis == "‡πÉ‡∏ä‡πà" else 0,
    "amphetamine": 1 if amphetamine == "‡πÉ‡∏ä‡πà" else 0,
    "drugs": 1 if drugs == "‡πÉ‡∏ä‡πà" else 0
}])

X_scaled = scaler.transform(X_new)
cluster = int(kmeans.predict(X_scaled)[0])

if st.button("‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°"):
    if cluster == 0:
        desc = "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≥ (‡∏ö‡∏≤‡∏î‡πÄ‡∏à‡πá‡∏ö‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢)"
    elif cluster == 1:
        desc = "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (‡∏ö‡∏≤‡∏î‡πÄ‡∏à‡πá‡∏ö‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)"
    else:
        desc = "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á (‡∏ä‡∏≤‡∏¢‡∏≠‡∏≤‡∏¢‡∏∏‡∏ô‡πâ‡∏≠‡∏¢, ‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô, ‡∏°‡∏µ‡∏™‡∏≤‡∏£‡πÄ‡∏™‡∏û‡∏ï‡∏¥‡∏î)"
    st.success(f"‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà {cluster} ‚Üí {desc}")
